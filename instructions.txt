# YOU MUST USE THIS DEVSTACK BRANCH: https://github.com/openedx/devstack/pull/1282
# Create a "just in case" directory to keep all your backup files
# outside of the devstack directory
mkdir ~/devstack-backups-march-6-2024/

cd $DEVSTACK_WORKSPACE/devstack
git pull
git checkout aed/mysqldump

## This will now create both a mysqldump output SQL file, and
## some tar'd data directories for the other database types.
make dev.backup
cp .dev/devstackall.sql ~/devstack-backups-march-6-2024/
cp .dev/backups/*.tar.gz ~/devstack-backups-march-6-2024/

## NOW BACKUP ALL THE ENTERPRISE IDAS
### enterprise-catalog
cd $DEVSTACK_WORKSPACE/enterprise-catalog
make dev.backup
cp .dev/enterprise_catalog_all.sql ~/devstack-backups-march-6-2024/
### license-manager
cd $DEVSTACK_WORKSPACE/license-manager
make dev.backup
cp .dev/license_manager_all.sql ~/devstack-backups-march-6-2024/
### enterprise-access
cd $DEVSTACK_WORKSPACE/enterprise-access
make dev.backup
cp .dev/enterprise_access_all.sql ~/devstack-backups-march-6-2024/
### enterprise-subsidy
cd $DEVSTACK_WORKSPACE/enterprise-subsidy
make dev.backup
cp .dev/enterprise_subsidy_all.sql ~/devstack-backups-march-6-2024/